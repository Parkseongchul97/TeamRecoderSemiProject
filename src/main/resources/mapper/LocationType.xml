<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mapper.LocationTypeMapper">

	<resultMap type="MemberLocTypeDTO" id="membershipMap">
		<id property="membershipCode" column="membership_code" />
		<result property="membershipName" column="membership_name" />
		<result property="membershipImg" column="membership_img" />
		<result property="membershipInfo" column="membership_info" />
		<result property="membershipDate" column="membership_date" />
		<result property="membershipGrade" column="membership_grade" />
		<result property="membershipMax" column="membership_max" />
	</resultMap>
	
	<resultMap type="LocationCategory" id="locationMap">
		<id column="loc_code" property="locCode"/> <!-- 프라이머리키 -->
		<result column="loc_la_name" property="locLaName"/>
		<result column="loc_s_name" property="locSName"/>
	</resultMap>
	
	
	<resultMap type="TypeCategory" id="typeMap">
		<id column="type_code" property="typeCode"/> <!-- 프라이머리키 -->
		<result column="type_la_name" property="typeLaName"/>
		<result column="type_s_name" property="typeSName"/>
	</resultMap>
	
	
	<!--  전체 리스트 -->
	<select id="memberLocTypeList" resultMap="membershipMap" parameterType="SearchDTO">
		SELECT * FROM membership
		<where>
			<if test="locations != null">
				membership_code IN 
				<foreach collection="locations" item="code" open="(" close=")" separator=",">
					#{code}
				</foreach>
			</if>
		</where>
	</select>
	
	
	<!-- 멤버십 위치 가져오기 -->
	<select id="locationList" parameterType="Integer" resultMap="locationMap">
		SELECT * 
		FROM membership_location 
		JOIN location_category USING (loc_code)
		WHERE membership_code = #{code}
	</select>
		
	<!-- 멤버십에 따른 타입 가져오기 -->	
	<select id="typeList" parameterType="Integer" resultMap="typeMap">
		SELECT *
		FROM membership_type
		JOIN type_category USING (type_code)
		WHERE membership_code = #{code};
	</select>
	
	<!--  지역 상위 카테고리  -->
	<select id="locLaNameList" resultType="String">
		SELECT DISTINCT loc_la_name 
		FROM location_category
	</select>
	
	<!-- 지역 상위 선택에 따른 멤버십 코드 뽑기 -->
	<select id="searchLocLaNameList" parameterType="String" resultType="Integer">
		select DISTINCT membership_code
		from membership_location
		WHERE loc_code IN (SELECT loc_code
		FROM location_category
		WHERE loc_la_name = #{location})
	</select>
		
		
</mapper>